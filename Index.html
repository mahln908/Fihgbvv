<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sabor de Casa - Receitas Deliciosas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}
        :root{--primary-color:#FF8C42;--secondary-color:#7B3F00;--accent-color:#FFE66D;--dark-color:#292F36;--light-color:#FFF9F0}
        body{background-color:var(--light-color);color:var(--dark-color);line-height:1.6}
        header{background:var(--primary-color);color:white;padding:0.8rem;text-align:center;box-shadow:0 2px 8px rgba(0,0,0,0.1);position:sticky;top:0;z-index:100}
        .logo-container{display:flex;justify-content:center;align-items:center;margin-bottom:0.4rem}
        .logo-text{background:rgba(255,255,255,0.2);padding:6px 12px;border-radius:6px;backdrop-filter:blur(5px);display:flex;align-items:center;justify-content:center}
        .pan-icon{font-size:1.8rem;color:black;animation:smoke 3s infinite;position:relative;margin-right:12px}
        @keyframes smoke{0%{transform:translateY(0)}25%{transform:translateY(-5px)}50%{transform:translateY(0)}75%{transform:translateY(5px)}100%{transform:translateY(0)}}
        .pan-icon::after{content:'\f75f';font-family:'Font Awesome 6 Free';font-weight:900;position:absolute;top:-16px;left:50%;transform:translateX(-50%);font-size:1rem;opacity:0.7;animation:smokeRise 3s infinite;color:#555}
        @keyframes smokeRise{0%{opacity:0;transform:translateX(-50%) translateY(0) scale(0.5)}50%{opacity:0.5;transform:translateX(-50%) translateY(-12px) scale(0.8)}100%{opacity:0;transform:translateX(-50%) translateY(-24px) scale(1)}}
        h1{font-size:1.8rem;margin:0;text-shadow:2px 2px 4px rgba(0,0,0,0.3);display:inline}
        .tagline{font-style:italic;margin-bottom:0.6rem;font-size:0.8rem}
        .search-container{margin:0.6rem auto;max-width:400px;position:relative}
        .search-input{width:100%;padding:8px 16px;border:none;border-radius:30px;font-size:0.8rem;box-shadow:0 2px 8px rgba(0,0,0,0.1)}
        .search-input:focus{outline:none;box-shadow:0 2px 8px rgba(0,0,0,0.2)}
        .search-btn{position:absolute;right:4px;top:4px;background:var(--secondary-color);border:none;color:white;padding:4px 10px;border-radius:30px;cursor:pointer;font-size:0.8rem}
        .categories{display:flex;overflow-x:auto;gap:6px;padding:0.6rem;margin:0.6rem 0;scrollbar-width:thin;-ms-overflow-style:none}
        .categories::-webkit-scrollbar{height:4px}
        .categories::-webkit-scrollbar-thumb{background:var(--primary-color);border-radius:10px}
        .category-btn{background:white;border:none;padding:6px 12px;border-radius:30px;cursor:pointer;font-weight:600;white-space:nowrap;transition:all 0.3s ease;box-shadow:0 2px 4px rgba(0,0,0,0.1);font-size:0.8rem}
        .category-btn:hover{background:var(--accent-color);transform:translateY(-2px)}
        .category-btn.active{background:var(--secondary-color);color:white}
        .container{max-width:1200px;margin:0 auto;padding:1rem}
        .recipe-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:1.2rem;margin-top:1.2rem}
        .recipe-card{background:white;border-radius:8px;overflow:hidden;box-shadow:0 3px 10px rgba(0,0,0,0.1);transition:transform 0.3s ease,box-shadow 0.3s ease;cursor:pointer;height:280px;display:flex;flex-direction:column}
        .recipe-card:hover{transform:translateY(-6px);box-shadow:0 10px 20px rgba(0,0,0,0.15)}
        .recipe-image{width:100%;height:180px;object-fit:cover}
        .recipe-content{padding:0.8rem;display:flex;flex-direction:column;justify-content:space-between;flex-grow:1}
        .recipe-title{font-size:1rem;margin-bottom:0.4rem;color:var(--dark-color);font-weight:600;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
        .recipe-meta{display:flex;justify-content:space-between;align-items:center}
        .recipe-category{background:var(--secondary-color);color:white;padding:2px 6px;border-radius:12px;font-size:0.7rem}
        .recipe-time{display:flex;align-items:center;color:#666;font-size:0.8rem}
        .recipe-time i{margin-right:4px;color:var(--primary-color);font-size:0.8rem}
        .ad-space{grid-column:1/-1;background:#f5f5f5;border-radius:8px;padding:1rem;text-align:center;margin:1rem 0;height:150px;display:flex;flex-direction:column;justify-content:center;align-items:center;border:2px dashed #ccc}
        .ad-space i{font-size:2rem;color:#ccc;margin-bottom:0.5rem}
        .ad-space p{color:#888;font-size:0.9rem}
        footer{background:var(--dark-color);color:white;text-align:center;padding:1.2rem;margin-top:2rem;font-size:0.8rem}
        .loading{text-align:center;padding:1.2rem;font-size:1rem;color:var(--secondary-color)}
        .loading i{animation:spin 1s infinite linear;margin-right:8px}
        @keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
        .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,0.8);z-index:1000;overflow-y:auto;padding:12px}
        .modal-content{background-color:white;margin:1.2rem auto;max-width:700px;border-radius:8px;overflow:hidden;box-shadow:0 5px 20px rgba(0,0,0,0.3)}
        .modal-header{padding:1rem;background:var(--primary-color);color:white;position:relative}
        .modal-close{position:absolute;top:0.6rem;right:0.6rem;background:none;border:none;color:white;font-size:1.1rem;cursor:pointer}
        .modal-title{font-size:1.5rem;margin-bottom:0.4rem}
        .modal-image{width:100%;max-height:300px;object-fit:cover}
        .modal-body{padding:1.2rem}
        .modal-meta{display:flex;justify-content:space-between;margin-bottom:1rem;padding-bottom:0.6rem;border-bottom:1px solid #eee}
        .modal-section{margin-bottom:1.2rem}
        .modal-section h3{color:var(--primary-color);margin-bottom:0.6rem;padding-bottom:0.3rem;border-bottom:2px solid var(--accent-color);font-size:1.1rem}
        .modal-ingredients{columns:2;list-style-type:none}
        .modal-ingredients li{margin-bottom:0.4rem;padding-left:1rem;position:relative}
        .modal-ingredients li:before{content:"•";color:var(--primary-color);font-weight:bold;position:absolute;left:0}
        .modal-instructions{line-height:1.6}
        @media (max-width:768px){.recipe-grid{grid-template-columns:repeat(auto-fill,minmax(220px,1fr))}h1{font-size:1.5rem}.modal-ingredients{columns:1}.pan-icon{font-size:1.5rem;margin-right:10px}}
        @media (max-width:480px){.recipe-grid{grid-template-columns:1fr}h1{font-size:1.3rem}.logo-text{flex-direction:row}.pan-icon{margin-right:8px;margin-bottom:0}.modal-content{margin:0.8rem auto}.modal-body{padding:1rem}.modal-title{font-size:1.2rem}.modal-header{padding:0.8rem}}
    </style>
</head>
<body>
    <header>
        <div class="logo-container">
            <div class="logo-text">
                <div class="pan-icon"><i class="fas fa-pot-food"></i></div>
                <h1>Sabor de Casa</h1>
            </div>
        </div>
        <p class="tagline">Receitas deliciosas para o seu dia a dia</p>
        <div class="search-container">
            <input type="text" class="search-input" id="search-input" placeholder="Buscar receitas...">
            <button class="search-btn" id="search-btn"><i class="fas fa-search"></i></button>
        </div>
        <div class="categories" id="categories-container">
            <button class="category-btn active" data-category="all">Todas</button>
        </div>
    </header>

    <div class="container">
        <div class="loading" id="loading"><i class="fas fa-spinner"></i> Carregando receitas...</div>
        <div class="recipe-grid" id="recipe-grid"></div>
    </div>

    <footer>
        <p>&copy; 2023 Sabor de Casa - Todos os direitos reservados</p>
        <p>Desenvolvido com <i class="fas fa-heart" style="color: var(--primary-color);"></i> para amantes da culinária</p>
    </footer>

    <div class="modal" id="recipe-modal">
        <div class="modal-content">
            <div class="modal-header">
                <button class="modal-close" id="modal-close"><i class="fas fa-times"></i></button>
                <h2 class="modal-title" id="modal-title"></h2>
                <div class="modal-meta">
                    <span class="recipe-category" id="modal-category"></span>
                    <span class="recipe-time" id="modal-time"></span>
                </div>
            </div>
            <img class="modal-image" id="modal-image" src="" alt="">
            <div class="modal-body">
                <div class="modal-section">
                    <h3>Ingredientes</h3>
                    <ul class="modal-ingredients" id="modal-ingredients"></ul>
                </div>
                <div class="modal-section">
                    <h3>Modo de Preparo</h3>
                    <p class="modal-instructions" id="modal-instructions"></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API key e ID da planilha
        const API_KEY = 'AIzaSyBqhpdzVXugN1GgkRUUHJ4Yo5JvjvY_wBc';
        const SPREADSHEET_ID = '14dMXRPrTP6SCldqhprh2wulLtZJZSL3XQpawWISATVc';
        const RANGE = 'A:F';

        // Elementos do DOM
        const recipeGrid = document.getElementById('recipe-grid');
        const loadingElement = document.getElementById('loading');
        const categoriesContainer = document.getElementById('categories-container');
        const searchInput = document.getElementById('search-input');
        const searchBtn = document.getElementById('search-btn');
        const modal = document.getElementById('recipe-modal');
        const modalClose = document.getElementById('modal-close');
        const modalTitle = document.getElementById('modal-title');
        const modalCategory = document.getElementById('modal-category');
        const modalTime = document.getElementById('modal-time');
        const modalImage = document.getElementById('modal-image');
        const modalIngredients = document.getElementById('modal-ingredients');
        const modalInstructions = document.getElementById('modal-instructions');

        // Variáveis para armazenar as receitas
        let recipes = [];
        let filteredRecipes = [];
        let categories = new Set(["all"]);

        // Categorias padrão para fallback (removidas "Bolo" e "Prato Principal")
        const defaultCategories = [
            "Sobremesa", "Salada", "Lanche", "Aperitivo", "Bebida", 
            "Massas", "Carnes", "Aves", "Peixes", "Vegetariano", "Vegano",
            "Low Carb", "Sem Glúten", "Sem Lactose", "Sopas", "Molhos", 
            "Pães", "Bolachas", "Doces", "Salgados", "Light", "Fitness", 
            "Caseiro", "Rápido", "Festa", "Natal", "Páscoa"
        ];

        // Função para converter link do Google Drive em link direto para imagem
        function convertGoogleDriveLink(url) {
            if (!url) return null;
            
            // Se já for um link direto de imagem, retorna como está
            if (url.match(/\.(jpeg|jpg|gif|png|webp|svg)(\?.*)?$/i)) return url;
            
            // Se for um link do Google Drive, converte para link direto
            if (url.includes('drive.google.com')) {
                // Padrão: https://drive.google.com/file/d/FILE_ID/view?usp=drivesdk
                const match = url.match(/\/d\/([^\/]+)/);
                if (match && match[1]) {
                    return `https://drive.google.com/uc?export=view&id=${match[1]}`;
                }
            }
            
            // Se não for um link reconhecido, retorna o original
            return url;
        }

        // Função para atualizar as categorias na interface
        function updateCategories() {
            const allButton = categoriesContainer.querySelector('[data-category="all"]');
            categoriesContainer.innerHTML = '';
            categoriesContainer.appendChild(allButton);
            
            categories.forEach(category => {
                if (category !== "all") {
                    const button = document.createElement('button');
                    button.className = 'category-btn';
                    button.setAttribute('data-category', category);
                    button.textContent = category;
                    categoriesContainer.appendChild(button);
                }
            });
            
            addCategoryEventListeners();
        }

        // Função para adicionar event listeners aos botões de categoria
        function addCategoryEventListeners() {
            const categoryButtons = categoriesContainer.querySelectorAll('.category-btn');
            categoryButtons.forEach(button => {
                button.addEventListener('click', () => {
                    categoryButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    filterRecipesByCategory(button.getAttribute('data-category'));
                });
            });
        }

        // Função para buscar dados da planilha
        async function fetchSheetData() {
            try {
                loadingElement.style.display = 'block';
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${RANGE}?key=${API_KEY}`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (data && data.values && data.values.length > 1) {
                    const headers = data.values[0].map(header => header.toLowerCase().replace(/\s+/g, ''));
                    const rows = data.values.slice(1);
                    
                    categories.clear();
                    categories.add("all");
                    
                    recipes = rows.map(row => {
                        const recipe = {};
                        headers.forEach((header, index) => {
                            recipe[header] = row[index] || '';
                        });
                        
                        // Processar URL da imagem (converter link do Google Drive se necessário)
                        if (recipe.url) {
                            recipe.processedUrl = convertGoogleDriveLink(recipe.url);
                        }
                        
                        if (recipe.categoria && recipe.categoria.trim() !== '') {
                            categories.add(recipe.categoria.trim());
                        }
                        
                        return recipe;
                    });
                    
                    if (categories.size < 5) {
                        defaultCategories.forEach(cat => categories.add(cat));
                    }
                    
                    updateCategories();
                    displayRecipes(recipes);
                } else {
                    throw new Error('Dados não encontrados na planilha');
                }
            } catch (error) {
                console.error('Erro ao buscar dados:', error);
                recipeGrid.innerHTML = `<div class="error">Erro ao carregar receitas: ${error.message}. Verifique se a planilha está pública.</div>`;
                loadSampleData();
            } finally {
                loadingElement.style.display = 'none';
            }
        }

        // Função para carregar dados de exemplo
        function loadSampleData() {
            recipes = [
                {
                    nome: "Torta de Limão",
                    categoria: "Sobremesa",
                    tempo: "1h",
                    ingrediente: "Leite condensado\nSuco de limão\nBiscoito maisena\nManteiga\nCreme de leite",
                    mododepreparo: "Misture o biscoito triturado com manteiga derretida para fazer a base. Prepare o recheio com leite condensado, suco de limão and creme de leite. Leve à geladeira por 2 horas antes de servir.",
                    url: "https://drive.google.com/file/d/193yzMs10cmSxsFWxWMvIvoNQKNsxaBLT/view?usp=drivesdk",
                    processedUrl: "https://drive.google.com/uc?export=view&id=193yzMs10cmSxsFWxWMvIvoNQKNsxaBLT"
                },
                {
                    nome: "Salada Tropical",
                    categoria: "Salada",
                    tempo: "15min",
                    ingrediente: "Alface\nManga\nAbacaxi\nFrango desfiado\nCastanhas\nMolho de iogurte",
                    mododepreparo: "Misture todos os ingredientes em uma tigela. Adicione o molho de iogurte e sirva fresco.",
                    url: "https://drive.google.com/file/d/1abc123def456ghi789jkl/view?usp=drivesdk",
                    processedUrl: "https://drive.google.com/uc?export=view&id=1abc123def456ghi789jkl"
                }
            ];
            
            categories.clear();
            categories.add("all");
            recipes.forEach(recipe => {
                if (recipe.categoria && recipe.categoria.trim() !== '') {
                    categories.add(recipe.categoria.trim());
                }
            });
            
            defaultCategories.forEach(cat => categories.add(cat));
            updateCategories();
            filteredRecipes = recipes;
            displayRecipes(filteredRecipes);
        }

        // Função para exibir as receitas
        function displayRecipes(recipesToDisplay) {
            recipeGrid.innerHTML = '';
            if (recipesToDisplay.length === 0) {
                recipeGrid.innerHTML = '<p class="no-results">Nenhuma receita encontrada.</p>';
                return;
            }
            
            recipesToDisplay.forEach((recipe, index) => {
                if (index > 0 && index % 2 === 0) {
                    const adSpace = document.createElement('div');
                    adSpace.className = 'ad-space';
                    adSpace.innerHTML = `<i class="fas fa-ad"></i><p>Espaço para publicidade</p>`;
                    recipeGrid.appendChild(adSpace);
                }
                
                const recipeCard = document.createElement('div');
                recipeCard.className = 'recipe-card';
                recipeCard.addEventListener('click', () => openRecipeModal(recipe));
                
                const imageUrl = recipe.processedUrl || recipe.url || 'https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80';
                
                recipeCard.innerHTML = `
                    <img src="${imageUrl}" alt="${recipe.nome}" class="recipe-image" onerror="this.src='https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80'">
                    <div class="recipe-content">
                        <h3 class="recipe-title">${recipe.nome}</h3>
                        <div class="recipe-meta">
                            <span class="recipe-category">${recipe.categoria}</span>
                            <span class="recipe-time"><i class="fas fa-clock"></i> ${recipe.tempo}</span>
                        </div>
                    </div>
                `;
                
                recipeGrid.appendChild(recipeCard);
            });
        }

        // Função para abrir o modal com a receita completa
        function openRecipeModal(recipe) {
            modalTitle.textContent = recipe.nome;
            modalCategory.textContent = recipe.categoria;
            modalTime.innerHTML = `<i class="fas fa-clock"></i> ${recipe.tempo}`;
            
            const imageUrl = recipe.processedUrl || recipe.url || 'https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80';
            modalImage.src = imageUrl;
            modalImage.alt = recipe.nome;
            
            modalIngredients.innerHTML = '';
            if (recipe.ingrediente && typeof recipe.ingrediente === 'string') {
                recipe.ingrediente.split('\n').forEach(ingredient => {
                    if (ingredient.trim()) {
                        const li = document.createElement('li');
                        li.textContent = ingredient;
                        modalIngredients.appendChild(li);
                    }
                });
            }
            
            modalInstructions.textContent = recipe.mododepreparo || '';
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        // Função para filtrar receitas por categoria
        function filterRecipesByCategory(category) {
            filteredRecipes = category === 'all' ? recipes : recipes.filter(recipe => 
                recipe.categoria && recipe.categoria.toLowerCase() === category.toLowerCase()
            );
            displayRecipes(filteredRecipes);
        }

        // Função para pesquisar receitas
        function searchRecipes() {
            const searchTerm = searchInput.value.toLowerCase();
            if (searchTerm === '') {
                displayRecipes(filteredRecipes);
                return;
            }
            
            const searchResults = filteredRecipes.filter(recipe => 
                recipe.nome.toLowerCase().includes(searchTerm) ||
                (recipe.categoria && recipe.categoria.toLowerCase().includes(searchTerm))
            );
            
            displayRecipes(searchResults);
        }

        // Event listeners
        searchBtn.addEventListener('click', searchRecipes);
        searchInput.addEventListener('keyup', (e) => { if (e.key === 'Enter') searchRecipes(); });
        modalClose.addEventListener('click', () => { modal.style.display = 'none'; document.body.style.overflow = 'auto'; });
        window.addEventListener('click', (e) => { if (e.target === modal) { modal.style.display = 'none'; document.body.style.overflow = 'auto'; } });

        // Inicializar a busca de dados quando a página carregar
        document.addEventListener('DOMContentLoaded', fetchSheetData);
    </script>
</body>
</html>
