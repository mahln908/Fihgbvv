<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Receita Completa - Sabor de Casa</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
        .recipe-detail-page {
            margin-top: 80px;
            padding: 30px 5%;
            max-width: 1000px;
            margin-left: auto;
            margin-right: auto;
        }

        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background-color: var(--secondary);
            color: white;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: 600;
            margin-bottom: 30px;
            transition: background-color 0.3s;
        }

        .back-button:hover {
            background-color: #1a252f;
        }

        .recipe-header {
            background-color: white;
            border-radius: 12px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }

        .recipe-header h1 {
            color: var(--secondary);
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .recipe-meta {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .recipe-meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #7f8c8d;
            font-weight: 600;
        }

        .recipe-meta-item i {
            color: var(--primary);
        }

        .recipe-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 40px;
        }

        .recipe-section {
            background-color: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
        }

        .recipe-section h2 {
            color: var(--secondary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--gray);
        }

        @media (max-width: 768px) {
            .recipe-content {
                grid-template-columns: 1fr;
            }
            
            .recipe-header {
                padding: 25px;
            }
            
            .recipe-header h1 {
                font-size: 2rem;
            }
        }

        @media (max-width: 576px) {
            .recipe-detail-page {
                padding: 20px;
            }
            
            .recipe-section {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Header simplificado -->
    <header>
        <div class="header-container">
            <a href="index.html" class="logo">
                <i class="fas fa-utensils"></i>
                <span>Sabor de Casa</span>
            </a>
        </div>
    </header>

    <!-- Conteúdo da receita -->
    <main class="recipe-detail-page">
        <a href="index.html" class="back-button">
            <i class="fas fa-arrow-left"></i> Voltar para todas as receitas
        </a>

        <div class="recipe-header">
            <span class="modal-category" id="recipe-category">Carregando...</span>
            <h1 id="recipe-title">Carregando receita...</h1>
            <div class="recipe-meta">
                <div class="recipe-meta-item">
                    <i class="far fa-clock"></i>
                    <span id="recipe-time">Carregando...</span>
                </div>
                <div class="recipe-meta-item">
                    <i class="fas fa-user-friends"></i>
                    <span id="recipe-servings">Informação não disponível</span>
                </div>
            </div>
        </div>

        <div class="recipe-content">
            <div class="recipe-section">
                <h2>Ingredientes</h2>
                <ul class="ingredients-list" id="recipe-ingredients">
                    <li>Carregando ingredientes...</li>
                </ul>
            </div>

            <div class="recipe-section">
                <h2>Modo de Preparo</h2>
                <div class="preparation-steps" id="recipe-preparation">
                    <p>Carregando modo de preparo...</p>
                </div>
            </div>
        </div>

        <div class="recipe-section">
            <h2>Informações Adicionais</h2>
            <div class="recipe-footer">
                <div class="modal-message" id="recipe-message"></div>
                <a href="#" class="modal-url" target="_blank" id="recipe-url">
                    <i class="fas fa-external-link-alt"></i>
                    Ver receita original
                </a>
            </div>
        </div>
    </main>

    <script>
        // Função para obter parâmetros da URL
        function getUrlParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // Função para carregar receita específica
        async function loadRecipeDetail() {
            const recipeId = getUrlParameter('id');
            
            if (!recipeId) {
                showError('ID da receita não especificado.');
                return;
            }

            try {
                // Carregar todas as receitas da planilha
                const SPREADSHEET_ID = '14dMXRPrTP6SCldqhprh2wulLtZJZSL3XQpawWISATVc';
                const API_KEY = 'AIzaSyBqhpdzVXugN1GgkRUUHJ4Yo5JvjvY_wBc';
                const SHEET_NAME = 'Receitas%20Sabor%20de%20Casa';
                const API_URL = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${SHEET_NAME}?key=${API_KEY}`;
                
                const response = await fetch(API_URL);
                const data = await response.json();
                
                if (!data.values || data.values.length === 0) {
                    showError('Nenhuma receita encontrada na planilha.');
                    return;
                }
                
                // Extrair cabeçalhos
                const headers = data.values[0].map(header => header.trim().toLowerCase());
                
                // Encontrar a receita pelo ID
                const recipeData = data.values.slice(1)[recipeId];
                
                if (!recipeData) {
                    showError('Receita não encontrada.');
                    return;
                }
                
                // Criar objeto da receita
                const recipe = {};
                headers.forEach((header, index) => {
                    if (header === 'mododepreparo') {
                        recipe['modoDePreparo'] = recipeData[index] || '';
                    } else {
                        recipe[header] = recipeData[index] || '';
                    }
                });
                
                // Preencher os dados da receita
                displayRecipe(recipe);
                
            } catch (error) {
                console.error('Erro ao carregar receita:', error);
                showError('Erro ao carregar a receita. Tente novamente.');
            }
        }

        // Exibir receita na página
        function displayRecipe(recipe) {
            // Título da página
            document.title = `${recipe.nome} - Sabor de Casa`;
            
            // Informações básicas
            document.getElementById('recipe-category').textContent = recipe.categoria || 'Geral';
            document.getElementById('recipe-title').textContent = recipe.nome || 'Receita sem nome';
            document.getElementById('recipe-time').textContent = recipe.tempo || 'Não especificado';
            
            // Ingredientes
            const ingredientsList = document.getElementById('recipe-ingredients');
            ingredientsList.innerHTML = '';
            
            if (recipe.ingrediente) {
                const ingredients = recipe.ingrediente.split(',')
                    .map(ing => ing.trim())
                    .filter(ing => ing !== '');
                
                if (ingredients.length > 0) {
                    ingredients.forEach(ingredient => {
                        const li = document.createElement('li');
                        li.textContent = ingredient;
                        ingredientsList.appendChild(li);
                    });
                } else {
                    const li = document.createElement('li');
                    li.textContent = 'Ingredientes não especificados';
                    ingredientsList.appendChild(li);
                }
            } else {
                const li = document.createElement('li');
                li.textContent = 'Ingredientes não especificados';
                ingredientsList.appendChild(li);
            }
            
            // Modo de preparo
            const preparationSteps = document.getElementById('recipe-preparation');
            if (recipe.modoDePreparo && recipe.modoDePreparo.trim() !== '') {
                const formattedSteps = recipe.modoDePreparo
                    .split('\n')
                    .filter(step => step.trim() !== '')
                    .map(step => `<p>${step.trim()}</p>`)
                    .join('');
                
                preparationSteps.innerHTML = formattedSteps;
            } else {
                preparationSteps.innerHTML = '<p>Modo de preparo não especificado.</p>';
            }
            
            // Mensagem
            const messageElement = document.getElementById('recipe-message');
            if (recipe.mensagem && recipe.mensagem.trim() !== '') {
                messageElement.textContent = recipe.mensagem;
                messageElement.style.display = 'block';
            } else {
                messageElement.style.display = 'none';
            }
            
            // URL
            const urlLink = document.getElementById('recipe-url');
            if (recipe.url && recipe.url.trim() !== '' && recipe.url.startsWith('http')) {
                urlLink.href = recipe.url;
                urlLink.style.display = 'flex';
            } else {
                urlLink.style.display = 'none';
            }
        }

        // Mostrar erro
        function showError(message) {
            const main = document.querySelector('main');
            main.innerHTML = `
                <div class="no-results" style="margin-top: 100px;">
                    <i class="fas fa-exclamation-circle"></i>
                    <h3>${message}</h3>
                    <a href="index.html" class="back-button">
                        <i class="fas fa-arrow-left"></i> Voltar para todas as receitas
                    </a>
                </div>
            `;
        }

        // Carregar receita quando a página estiver pronta
        document.addEventListener('DOMContentLoaded', loadRecipeDetail);
    </script>
</body>
</html>
