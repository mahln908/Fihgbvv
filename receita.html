<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Receita Completa - Sabor de Casa</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body { 
            background-color: #f8f8f8; 
            color: #333; 
            line-height: 1.6;
        }
        
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 0 15px; 
        }

        /* CABEÇALHO */
        header {
            position: fixed; 
            top: 0; 
            left: 0; 
            right: 0; 
            background-color: white; 
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); 
            z-index: 1000; 
            padding: 10px 0;
        }
        
        .header-top { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            height: 36px; 
        }
        
        .logo { 
            font-size: 1.6rem; 
            font-weight: 700; 
            color: #e74c3c; 
            display: flex; 
            align-items: center; 
            height: 100%; 
        }
        
        .logo i { 
            margin-right: 8px; 
        }
        
        .back-home-btn {
            background-color: #f8f8f8; 
            color: #333; 
            padding: 8px 15px; 
            border-radius: 5px; 
            text-decoration: none; 
            font-weight: 500; 
            transition: background-color 0.3s; 
            border: 1px solid #ddd; 
            cursor: pointer; 
            font-size: 0.9rem; 
            display: flex; 
            align-items: center; 
            gap: 5px;
        }
        
        .back-home-btn:hover { 
            background-color: #eee; 
        }

        /* ESPAÇADOR */
        .content-spacer { 
            height: 70px; 
        }

        /* CONTEÚDO PRINCIPAL */
        main { 
            min-height: calc(100vh - 150px); 
            padding: 30px 0;
        }

        /* RECEITA COMPLETA */
        .recipe-detail-container {
            background-color: white; 
            border-radius: 10px; 
            padding: 25px; 
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08); 
            margin: 0 auto;
            max-width: 900px;
        }
        
        .recipe-header { 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            margin-bottom: 25px; 
        }
        
        .recipe-detail-title { 
            font-size: 1.8rem; 
            color: #333; 
            margin-bottom: 10px; 
            line-height: 1.3;
        }
        
        .recipe-detail-category {
            display: inline-block; 
            background-color: #f0f7ff; 
            color: #3498db; 
            padding: 8px 16px; 
            border-radius: 15px; 
            font-size: 0.85rem; 
            font-weight: 600; 
            margin-bottom: 15px; 
        }
        
        .recipe-info { 
            display: flex; 
            align-items: center; 
            margin-bottom: 25px; 
            color: #666; 
        }
        
        .recipe-time-badge {
            display: flex; 
            align-items: center; 
            background-color: #fff5f5; 
            color: #e74c3c; 
            padding: 8px 16px; 
            border-radius: 15px; 
            font-weight: 600; 
            margin-right: 15px; 
            font-size: 0.9rem; 
        }
        
        .recipe-time-badge i { 
            margin-right: 8px; 
        }
        
        .recipe-sections { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 30px; 
            margin-top: 25px; 
        }
        
        @media (max-width: 768px) { 
            .recipe-sections { 
                grid-template-columns: 1fr; 
                gap: 20px;
            } 
        }
        
        .recipe-section { 
            margin-bottom: 25px; 
        }
        
        .section-title { 
            font-size: 1.3rem; 
            color: #333; 
            margin-bottom: 15px; 
            padding-bottom: 8px; 
            border-bottom: 2px solid #e74c3c; 
        }
        
        .ingredients-list { 
            list-style-type: none; 
        }
        
        .ingredients-list li { 
            padding: 8px 0; 
            border-bottom: 1px dashed #eee; 
            display: flex; 
            align-items: center; 
            font-size: 1rem; 
        }
        
        .ingredients-list li:before { 
            content: "•"; 
            color: #e74c3c; 
            font-size: 1.3rem; 
            margin-right: 10px; 
        }
        
        .instructions-list { 
            list-style-type: decimal; 
            padding-left: 20px; 
        }
        
        .instructions-list li { 
            padding: 10px 0; 
            border-bottom: 1px dashed #eee; 
            font-size: 1rem; 
            line-height: 1.5;
        }
        
        .recipe-image-large {
            width: 100%; 
            height: 300px; 
            background-color: #f5f5f5; 
            border-radius: 8px; 
            margin-bottom: 20px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            color: #777; 
            overflow: hidden;
        }
        
        .recipe-message {
            background-color: #f9f9f9; 
            padding: 20px; 
            border-radius: 8px; 
            margin-top: 25px; 
            border-left: 4px solid #e74c3c; 
            font-style: italic; 
            font-size: 1rem;
            line-height: 1.5;
        }

        /* LOADING E ERRO */
        .loading { 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 300px; 
            flex-direction: column; 
            gap: 20px; 
        }
        
        .spinner { 
            width: 50px; 
            height: 50px; 
            border: 5px solid rgba(231, 76, 60, 0.2); 
            border-radius: 50%; 
            border-top-color: #e74c3c; 
            animation: spin 1s linear infinite; 
        }
        
        @keyframes spin { 
            to { transform: rotate(360deg); } 
        }
        
        .error-message {
            background-color: #ffeaea; 
            color: #c0392b; 
            padding: 20px; 
            border-radius: 8px; 
            margin: 40px auto;
            max-width: 600px;
            text-align: center; 
            border-left: 4px solid #c0392b;
        }

        /* RODAPÉ */
        footer { 
            background-color: #333; 
            color: white; 
            padding: 30px 0 20px; 
            text-align: center; 
            margin-top: 40px;
        }
        
        .footer-content { 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            flex-direction: column; 
            margin-bottom: 20px; 
        }
        
        .footer-logo { 
            font-size: 1.5rem; 
            font-weight: 700; 
            color: #e74c3c; 
            margin-bottom: 15px; 
            display: flex; 
            align-items: center; 
            gap: 8px; 
        }
        
        .social-icons { 
            display: flex; 
            gap: 15px; 
            margin-top: 15px; 
        }
        
        .social-icons a {
            display: inline-flex; 
            align-items: center; 
            justify-content: center; 
            width: 40px; 
            height: 40px; 
            background-color: rgba(255, 255, 255, 0.1); 
            border-radius: 50%; 
            color: white; 
            transition: all 0.3s; 
        }
        
        .social-icons a:hover { 
            background-color: #e74c3c; 
            transform: translateY(-3px); 
        }
        
        .footer-bottom { 
            padding-top: 20px; 
            border-top: 1px solid rgba(255, 255, 255, 0.1); 
            color: #ccc; 
            font-size: 0.9rem; 
        }

        /* RESPONSIVIDADE */
        @media (max-width: 768px) {
            .recipe-detail-title { 
                font-size: 1.5rem; 
            }
            
            .recipe-image-large { 
                height: 250px; 
            }
            
            .recipe-detail-container {
                padding: 20px;
                margin: 0 10px;
            }
        }
        
        @media (max-width: 576px) {
            .recipe-detail-container { 
                padding: 15px; 
            }
            
            .recipe-detail-title { 
                font-size: 1.4rem; 
            }
            
            .recipe-sections {
                gap: 15px;
            }
            
            .content-spacer { 
                height: 60px; 
            }
        }

        img { 
            max-width: 100%; 
            height: auto; 
        }
    </style>
</head>
<body>
    <!-- CABEÇALHO -->
    <header>
        <div class="container header-top">
            <a href="principal.html" class="back-home-btn">
                <i class="fas fa-arrow-left"></i> Voltar
            </a>
            <div class="logo"><i class="fas fa-utensils"></i>Sabor de Casa</div>
        </div>
    </header>

    <!-- ESPAÇADOR -->
    <div class="content-spacer"></div>

    <!-- CONTEÚDO PRINCIPAL -->
    <main class="container">
        <div class="loading" id="loading"><div class="spinner"></div><p>Carregando receita...</p></div>
        
        <div class="recipe-detail-container" id="recipe-detail" style="display: none;"></div>
    </main>

    <!-- RODAPÉ -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo"><i class="fas fa-utensils"></i>Sabor de Casa</div>
                <p>Receitas deliciosas para o seu dia a dia</p>
                <div class="social-icons">
                    <a href="#"><i class="fab fa-facebook-f"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                    <a href="#"><i class="fab fa-youtube"></i></a>
                </div>
            </div>
            <div class="footer-bottom"><p>&copy; 2023 Sabor de Casa - Todos os direitos reservados</p></div>
        </div>
    </footer>

    <script>
        // URL DA PLANILHA
        const spreadsheetId = '14dMXRPrTP6SCldqhprh2wulLtZJZSL3XQpawWISATVc';
        const apiKey = 'AIzaSyBqhpdzVXugN1GgkRUUHJ4Yo5JvjvY_wBc';
        const sheetName = 'Receitas Sabor de Casa';
        const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${sheetName}?key=${apiKey}`;
        
        // FUNÇÃO PARA CRIAR ID DA RECEITA (DEVE SER IGUAL AO principal.html)
        function createRecipeId(title) {
            return title
                .toLowerCase()
                .normalize('NFD').replace(/[\u0300-\u036f]/g, '')
                .replace(/[^a-z0-9]+/g, '-')
                .replace(/^-+|-+$/g, '');
        }
        
        // OBTER ID DA RECEITA DA URL
        function getRecipeIdFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id') || '';
        }
        
        // CARREGAR RECEITA
        async function loadRecipe() {
            const loadingElement = document.getElementById('loading');
            const recipeId = getRecipeIdFromURL();
            
            try {
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`Erro ao carregar: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (!data.values || data.values.length < 2) {
                    showError('Nenhuma receita encontrada na planilha.');
                    return;
                }
                
                const headers = data.values[0];
                let foundRecipe = null;
                
                // PROCURAR RECEITA PELO ID
                for (let i = 1; i < data.values.length; i++) {
                    const row = data.values[i];
                    const recipe = {};
                    
                    headers.forEach((header, index) => {
                        const value = row[index] || '';
                        if (header === 'nome') recipe.title = value;
                        else if (header === 'categoria') recipe.category = value;
                        else if (header === 'tempo') recipe.time = value;
                        else if (header === 'ingrediente') recipe.ingredients = value;
                        else if (header === 'mododepreparo') recipe.instructions = value;
                        else if (header === 'url') recipe.imageUrl = value;
                        else if (index === 6) recipe.message = value;
                    });
                    
                    // VERIFICAR SE É A RECEITA PROCURADA
                    if (recipe.title) {
                        const currentRecipeId = createRecipeId(recipe.title);
                        if (recipeId && currentRecipeId === recipeId) {
                            foundRecipe = recipe;
                            break;
                        }
                    }
                }
                
                // SE NÃO ENCONTROU, USAR A PRIMEIRA RECEITA
                if (!foundRecipe && data.values.length > 1) {
                    const firstRow = data.values[1];
                    foundRecipe = {};
                    headers.forEach((header, index) => {
                        const value = firstRow[index] || '';
                        if (header === 'nome') foundRecipe.title = value;
                        else if (header === 'categoria') foundRecipe.category = value;
                        else if (header === 'tempo') foundRecipe.time = value;
                        else if (header === 'ingrediente') foundRecipe.ingredients = value;
                        else if (header === 'mododepreparo') foundRecipe.instructions = value;
                        else if (header === 'url') foundRecipe.imageUrl = value;
                        else if (index === 6) foundRecipe.message = value;
                    });
                }
                
                if (foundRecipe && foundRecipe.title) {
                    displayRecipe(foundRecipe);
                } else {
                    showError('Receita não encontrada.');
                }
                
            } catch (error) {
                console.error('Erro:', error);
                showError('Erro ao carregar a receita. Verifique sua conexão com a internet.');
            }
        }
        
        // EXIBIR RECEITA
        function displayRecipe(recipe) {
            const loadingElement = document.getElementById('loading');
            const recipeContainer = document.getElementById('recipe-detail');
            
            loadingElement.style.display = 'none';
            
            // CRIAR HTML DA RECEITA
            let imageHtml = '<div style="display:flex;align-items:center;justify-content:center;height:100%;color:#777;">Imagem da Receita</div>';
            if (recipe.imageUrl && recipe.imageUrl.trim() !== '') {
                imageHtml = `<img src="${recipe.imageUrl.trim()}" alt="${recipe.title}" style="width:100%;height:100%;object-fit:cover;border-radius:8px;">`;
            }
            
            // PROCESSAR INGREDIENTES
            let ingredientsHtml = '<li>Ingredientes não informados</li>';
            if (recipe.ingredients && recipe.ingredients.trim() !== '') {
                const ingredients = recipe.ingredients.split('\n').filter(item => item.trim() !== '');
                if (ingredients.length > 0) {
                    ingredientsHtml = ingredients.map(item => `<li>${item.trim()}</li>`).join('');
                } else {
                    const commaIngredients = recipe.ingredients.split(',').filter(item => item.trim() !== '');
                    if (commaIngredients.length > 0) {
                        ingredientsHtml = commaIngredients.map(item => `<li>${item.trim()}</li>`).join('');
                    } else {
                        ingredientsHtml = `<li>${recipe.ingredients}</li>`;
                    }
                }
            }
            
            // PROCESSAR MODO DE PREPARO
            let instructionsHtml = '<li>Modo de preparo não informado</li>';
            if (recipe.instructions && recipe.instructions.trim() !== '') {
                const instructions = recipe.instructions.split('\n').filter(item => item.trim() !== '');
                if (instructions.length > 0) {
                    instructionsHtml = instructions.map((item, index) => `<li>${item.trim()}</li>`).join('');
                } else {
                    instructionsHtml = `<li>${recipe.instructions}</li>`;
                }
            }
            
            // VERIFICAR SE TEM MENSAGEM
            let messageHtml = '';
            if (recipe.message && recipe.message.trim() !== '') {
                messageHtml = `
                    <div class="recipe-message">
                        ${recipe.message}
                    </div>
                `;
            }
            
            // MONTAR HTML COMPLETO
            recipeContainer.innerHTML = `
                <div class="recipe-header">
                    <a href="principal.html" class="back-home-btn">
                        <i class="fas fa-arrow-left"></i> Voltar para Receitas
                    </a>
                </div>
                
                <h2 class="recipe-detail-title">${recipe.title || 'Receita sem nome'}</h2>
                <span class="recipe-detail-category">${recipe.category || 'Geral'}</span>
                
                <div class="recipe-info">
                    <div class="recipe-time-badge">
                        <i class="far fa-clock"></i>
                        <span>${recipe.time || 'Tempo não informado'}</span>
                    </div>
                </div>
                
                <div class="recipe-image-large">
                    ${imageHtml}
                </div>
                
                <div class="recipe-sections">
                    <div class="recipe-section">
                        <h3 class="section-title">Ingredientes</h3>
                        <ul class="ingredients-list">
                            ${ingredientsHtml}
                        </ul>
                    </div>
                    
                    <div class="recipe-section">
                        <h3 class="section-title">Modo de Preparo</h3>
                        <ol class="instructions-list">
                            ${instructionsHtml}
                        </ol>
                    </div>
                </div>
                
                ${messageHtml}
            `;
            
            recipeContainer.style.display = 'block';
            document.title = `${recipe.title || 'Receita'} - Sabor de Casa`;
        }
        
        // MOSTRAR ERRO
        function showError(message) {
            const loadingElement = document.getElementById('loading');
            const recipeContainer = document.getElementById('recipe-detail');
            
            loadingElement.style.display = 'none';
            
            recipeContainer.innerHTML = `
                <div class="error-message">
                    <h3>Oops! Algo deu errado</h3>
                    <p>${message}</p>
                    <a href="principal.html" class="back-home-btn" style="margin-top:15px;display:inline-block;">
                        <i class="fas fa-arrow-left"></i> Voltar para Receitas
                    </a>
                </div>
            `;
            
            recipeContainer.style.display = 'block';
        }
        
        // INICIAR
        document.addEventListener('DOMContentLoaded', () => {
            loadRecipe();
        });
    </script>
</body>
</html>
