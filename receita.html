<!-- Adicionar este script no receita.html, substituindo o script existente -->

<script>
    // Carregar receita espec√≠fica - CORRIGIDO
    async function carregarReceita() {
        try {
            // Verificar conex√£o
            if (!navigator.onLine) {
                throw new Error('Sem conex√£o com a internet');
            }
            
            // Obter ID da URL
            const params = new URLSearchParams(window.location.search);
            const recipeId = parseInt(params.get('id')) || 1;
            
            // Carregar todas as receitas
            const response = await fetch('https://sheets.googleapis.com/v4/spreadsheets/14dMXRPrTP6SCldqhprh2wulLtZJZSL3XQpawWISATVc/values/Receitas%20Sabor%20de%20Casa?key=AIzaSyBqhpdzVXugN1GgkRUUHJ4Yo5JvjvY_wBc');
            const data = await response.json();
            
            if (!data.values || data.values.length < 2) {
                throw new Error('Sem dados na planilha');
            }
            
            // Encontrar receita
            const cabecalhos = data.values[0];
            const linhas = data.values.slice(1);
            
            // Verificar se o ID √© v√°lido
            if (recipeId < 1 || recipeId > linhas.length) {
                throw new Error('Receita n√£o encontrada');
            }
            
            const linha = linhas[recipeId - 1];
            
            // Mapear √≠ndices
            const nomeIndex = cabecalhos.findIndex(h => h.toLowerCase().includes('nome'));
            const categoriaIndex = cabecalhos.findIndex(h => h.toLowerCase().includes('categoria'));
            const tempoIndex = cabecalhos.findIndex(h => h.toLowerCase().includes('tempo'));
            const ingredienteIndex = cabecalhos.findIndex(h => h.toLowerCase().includes('ingrediente'));
            const preparoIndex = cabecalhos.findIndex(h => h.toLowerCase().includes('modo') || h.toLowerCase().includes('preparo'));
            const urlIndex = cabecalhos.findIndex(h => h.toLowerCase().includes('url'));
            const mensagemIndex = cabecalhos.findIndex(h => h.toLowerCase().includes('mensagem'));
            
            // Criar objeto receita
            const receita = {
                nome: (nomeIndex >= 0 && linha[nomeIndex]) ? linha[nomeIndex].toString().trim() : 'Receita',
                categoria: (categoriaIndex >= 0 && linha[categoriaIndex]) ? linha[categoriaIndex].toString().trim() : 'Geral',
                tempo: (tempoIndex >= 0 && linha[tempoIndex]) ? linha[tempoIndex].toString().trim() : 'Tempo n√£o informado',
                ingrediente: (ingredienteIndex >= 0 && linha[ingredienteIndex]) ? linha[ingredienteIndex].toString().trim() : '',
                mododepreparo: (preparoIndex >= 0 && linha[preparoIndex]) ? linha[preparoIndex].toString().trim() : '',
                url: (urlIndex >= 0 && linha[urlIndex]) ? linha[urlIndex].toString().trim() : '',
                mensagem: (mensagemIndex >= 0 && linha[mensagemIndex]) ? linha[mensagemIndex].toString().trim() : ''
            };
            
            // Exibir receita
            exibirReceita(receita);
            
        } catch (error) {
            console.error('Erro:', error);
            
            let mensagemErro = 'N√£o foi poss√≠vel carregar a receita.';
            if (error.message.includes('Sem conex√£o') || error.message.includes('Failed to fetch')) {
                mensagemErro = 'üì° Sem conex√£o com a internet<br><small>√â preciso dados m√≥veis ou Wi-Fi para carregar a receita</small>';
            } else if (error.message.includes('n√£o encontrada')) {
                mensagemErro = 'Receita n√£o encontrada.';
            }
            
            document.getElementById('recipeContent').innerHTML = `
                <div class="no-results">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>Erro ao carregar</h3>
                    <p>${mensagemErro}</p>
                    <a href="index.html" class="view-recipe" style="margin-top: 20px; display: inline-block;">
                        Voltar para receitas
                    </a>
                </div>
            `;
        }
    }
    
    function exibirReceita(receita) {
        // Preparar ingredientes
        let ingredientesHtml = '<li>Ingredientes n√£o informados</li>';
        if (receita.ingrediente && receita.ingrediente.trim()) {
            const ingredientes = receita.ingrediente.split(',').map(i => i.trim());
            ingredientesHtml = ingredientes.map(i => `<li>${i}</li>`).join('');
        }
        
        // Preparar modo de preparo
        let preparoHtml = '<p>Modo de preparo n√£o informado</p>';
        if (receita.mododepreparo && receita.mododepreparo.trim()) {
            const passos = receita.mododepreparo.split('\n').filter(p => p.trim());
            preparoHtml = passos.map(passo => `<div class="step">${passo.trim()}</div>`).join('');
        }
        
        const content = document.getElementById('recipeContent');
        content.innerHTML = `
            <div class="recipe-container">
                <div class="recipe-header">
                    <div class="recipe-category">${receita.categoria.split(',')[0].trim()}</div>
                    <h1 class="recipe-name">${receita.nome}</h1>
                    <div class="recipe-meta">
                        <span><i class="far fa-clock"></i> ${receita.tempo}</span>
                    </div>
                </div>
                
                <div class="recipe-content">
                    <div class="section">
                        <h2 class="section-title"><i class="fas fa-shopping-basket"></i> Ingredientes</h2>
                        <ul class="ingredients-list">${ingredientesHtml}</ul>
                    </div>
                    
                    <div class="section">
                        <h2 class="section-title"><i class="fas fa-list-ol"></i> Modo de Preparo</h2>
                        <div class="steps">${preparoHtml}</div>
                    </div>
                    
                    ${receita.mensagem && receita.mensagem.trim() ? `
                    <div class="recipe-message">
                        <p><strong>üí¨ Nota:</strong> ${receita.mensagem}</p>
                    </div>
                    ` : ''}
                    
                    <div class="recipe-actions">
                        <button class="action-btn share" id="shareBtn">
                            <i class="fas fa-share-alt"></i> Compartilhar
                        </button>
                        <button class="action-btn" onclick="window.print()">
                            <i class="fas fa-print"></i> Imprimir
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        // Bot√£o compartilhar
        document.getElementById('shareBtn').addEventListener('click', () => {
            if (navigator.share) {
                navigator.share({
                    title: receita.nome + ' - Sabor de Casa',
                    text: `Confira esta receita: ${receita.nome}`,
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(window.location.href);
                alert('Link copiado para a √°rea de transfer√™ncia!');
            }
        });
    }
    
    // Carregar quando p√°gina estiver pronta
    document.addEventListener('DOMContentLoaded', carregarReceita);
    
    // Detectar mudan√ßas na conex√£o
    window.addEventListener('online', () => {
        console.log('‚úÖ Conex√£o restaurada na p√°gina de receita');
    });
    
    window.addEventListener('offline', () => {
        console.log('‚ùå Conex√£o perdida na p√°gina de receita');
    });
            </script>
